<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<dom-module id="star-rating">
  <template>
    <custom-style>
      <style include="iron-flex">
       :host {
         --star-color: #4775D1 ;
       }

       iron-icon {
         color: var(--star-color);
       }

       paper-icon-button {
         color: var(--star-color);
         padding: 0px;
         width: 24px;
         height: 24px;
         --paper-icon-button-disabled: {
           color: #4775D1;
         };
       }
      </style>
    </custom-style>

    <div class="layout horizontal center-center">

      <template id="stars" is="dom-repeat" items="{{_stars}}" as="star">
        <iron-icon hidden$="[[!readOnly]]" icon="[[star]]"></iron-icon>
        <paper-icon-button hidden$="[[readOnly]]" id="{{index}}" on-click="_updateRate" icon="[[star]]"></paper-icon-button>
        <!-- <template is="dom-if" if="[[!readOnly]]">
             <paper-icon-button disabled$={{readOnly}} id="{{index}}" on-click="_updateRate" icon="[[star]]"></paper-icon-button>
             </template> -->
      </template>
    </div>

  </template>
  <script>
   /**
    * Shows 5 star rating or enables a 5 star rating using paper-icon-button and iron-icon.*
    *
    * ### Usage
    * Rate can be set as an attribute.
    *
    * ```html
    *  <star-rating rate="2.3"></star-rating>
    *  ```
    *
    *  ### Styling
    *  Custom property | Description | Default
    *  ----------------|-------------|----------
    *  `--star-color` | Color set for stars | `#4775D1`
    *
    *  @demo demo/index.html
    */
   class StarRating extends Polymer.Element {
     static get is() { return 'star-rating'; }

     static get properties() {
       return {
         _stars: {
           type: Array,
           value: ["star", "star", "star-half", "star", "star-border"]
         },

         // number of stars assigned for score
         rate: {
           type: Number,
           value: 0
         },

         readOnly: {
           type: Boolean,
           value: false
         }
       }
     }

     connectedCallback() {
       super.connectedCallback();
       Polymer.RenderStatus.beforeNextRender(this, () => {
         this._updateStars();
         this.$.stars.render();
       });
     }

     _updateRate(e) {
       let id = parseInt(e.currentTarget.id);
       this.rate = id + 1;
       this._updateStars();
     }

     _updateStars() {
       let int = Math.floor(this.rate);
       let decimal = this.rate % 1;

       for (var i = 0; i < 5; i++) {
         this._stars[i] = "star-border";
         if (i < int)
           this._stars[i] = "star";
       }

       if (decimal >= 0.5)
         this._stars[int] = "star-half";

       var array = this._stars;
       this._stars = [];
       this._stars = array;
     }
   }

   customElements.define(StarRating.is, StarRating);
  </script>
</dom-module>
