<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<dom-module id="star-rating">
  <template>
    <custom-style>
      <style include="iron-flex">
       iron-icon {
         color: var(--star-color, #faca43);
       }

       paper-icon-button {
         color: var(--star-color, #faca43);
         padding: 0px;
         width: 24px;
         height: 24px;
         --paper-icon-button-disabled: {
           color:  #faca43;
         };
       }
      </style>
    </custom-style>

    <div class="layout horizontal center-center">

      <template id="stars" is="dom-repeat" items="{{_stars}}" as="star">
        <iron-icon hidden$="[[!readOnly]]" icon="[[star]]"></iron-icon>
        <paper-icon-button hidden$="[[readOnly]]" id="{{index}}" on-click="_updateRating" icon="[[star]]"></paper-icon-button>
      </template>
    </div>

  </template>
  <script>
   /**
    * Shows 5 star rating or enables a 5 star rating using paper-icon-button and iron-icon.*
    *
    * ### Usage
    * Rating can be set as an attribute. It will round to the nearest half star,
    * so a rating of 2.3 would end up as 2.5 stars.
    *
    * ```html
    *  <star-rating rating="2.3"></star-rating>
    *  ```
    *
    *  ### Styling
    *  Custom property | Description | Default
    *  ----------------|-------------|----------
    *  `--star-color` | Color set for stars | `#4775D1`
    *
    *  @demo demo/index.html
    */
   class StarRating extends Polymer.Element {
     static get is() { return 'star-rating'; }

     static get properties() {
       return {
         _stars: {
           type: Array,
           value: ["star", "star", "star-half", "star", "star-border"]
         },

         // number of stars assigned for score
         rating: {
           type: Number,
           value: 0
         },

         readOnly: {
           type: Boolean,
           value: false
         }
       }
     }

     connectedCallback() {
       super.connectedCallback();
       Polymer.RenderStatus.beforeNextRender(this, () => {
         this._updateStars();
         this.$.stars.render();
       });
     }

     _updateRating(e) {
       let id = parseInt(e.currentTarget.id);
       this.rating = id + 1;
       this._updateStars();
     }

     _updateStars() {
       let int = Math.floor(this.rating);
       let decimal = this.rating % 1;

       for (var i = 0; i < 5; i++) {
         this._stars[i] = "star-border";
         if (i < int)
           this._stars[i] = "star";
       }

       if (decimal >= 0.5)
         this._stars[int] = "star-half";

       var array = this._stars;
       this._stars = [];
       this._stars = array;

       // update event for changes to star rating
       var details = {
         bubbles: true,
         composed: true,
         rating: this.rating
       };
       this.dispatchEvent(new CustomEvent('star-rating-updated'), details);
     }
   }

   customElements.define(StarRating.is, StarRating);
  </script>
</dom-module>
